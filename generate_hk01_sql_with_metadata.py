"""
Parse HK01 navigation HTML and generate SQL INSERT statements with metadata
"""
import re
import json

html_content = """<div class="mx-auto max-w-7xl px-4 py-6 lg:px-6"><div class="justify-between grid grid-cols-6 gap-1 gap-y-2 md:gap-2 lg:grid-cols-8"><div><a title="港聞" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/1/%E6%B8%AF%E8%81%9E">港聞</a><ul class="m-0 list-none p-0"><li><a title="社會新聞" target="_self" class="leading-7 text-black-78" href="/channel/2/%E7%A4%BE%E6%9C%83%E6%96%B0%E8%81%9E">社會新聞</a></li><li><a title="突發" target="_self" class="leading-7 text-black-78" href="/channel/6/%E7%AA%81%E7%99%BC">突發</a></li><li><a title="政情" target="_self" class="leading-7 text-black-78" href="/channel/310/%E6%94%BF%E6%83%85">政情</a></li><li><a title="偵查" target="_self" class="leading-7 text-black-78" href="/channel/143/01%E5%81%B5%E6%9F%A5">偵查</a></li><li><a title="教育" target="_self" class="leading-7 text-black-78" href="/zone/23/%E6%95%99%E8%82%B2">教育</a></li><li><a title="深度" target="_self" class="leading-7 text-black-78" href="/channel/413/%E6%B7%B1%E5%BA%A6%E5%A0%B1%E9%81%93">深度</a></li><li><a title="香港經濟" target="_self" class="leading-7 text-black-78" href="/channel/403/%E9%A6%99%E6%B8%AF%E7%B6%93%E6%BF%9F">香港經濟</a></li><li><a title="天氣" target="_self" class="leading-7 text-black-78" href="/channel/421/%E5%A4%A9%E6%B0%A3">天氣</a></li></ul></div><div><a title="娛樂" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/2/%E5%A8%9B%E6%A8%82">娛樂</a><ul class="m-0 list-none p-0"><li><a title="即時娛樂" target="_self" class="leading-7 text-black-78" href="/channel/22/%E5%8D%B3%E6%99%82%E5%A8%9B%E6%A8%82">即時娛樂</a></li><li><a title="人氣娛樂" target="_self" class="leading-7 text-black-78" href="/channel/488/%E4%BA%BA%E6%B0%A3%E5%A8%9B%E6%A8%82">人氣娛樂</a></li><li><a title="電影" target="_self" class="leading-7 text-black-78" href="/channel/66/%E9%9B%BB%E5%BD%B1">電影</a></li><li><a title="眾樂迷" target="_self" class="leading-7 text-black-78" href="/channel/447/%E7%9C%BE%E6%A8%82%E8%BF%B7">眾樂迷</a></li></ul></div><div><a title="國際" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/4/%E5%9C%8B%E9%9A%9B">國際</a><ul class="m-0 list-none p-0"><li><a title="即時國際" target="_self" class="leading-7 text-black-78" href="/channel/19/%E5%8D%B3%E6%99%82%E5%9C%8B%E9%9A%9B">即時國際</a></li><li><a title="環球趣聞" target="_self" class="leading-7 text-black-78" href="/channel/406/%E7%92%B0%E7%90%83%E8%B6%A3%E8%81%9E">環球趣聞</a></li><li><a title="國際分析" target="_self" class="leading-7 text-black-78" href="/channel/407/%E5%9C%8B%E9%9A%9B%E5%88%86%E6%9E%90">國際分析</a></li><li><a title="世界專題" target="_self" class="leading-7 text-black-78" href="/channel/405/%E4%B8%96%E7%95%8C%E5%B0%88%E9%A1%8C">世界專題</a></li><li><a title="紀實影像" target="_self" class="leading-7 text-black-78" href="/channel/259/%E7%B4%80%E5%AF%A6?itm_source=webmenu&amp;itm_medium=web">紀實影像</a></li></ul></div><div><a title="中國" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/5/%E4%B8%AD%E5%9C%8B">中國</a><ul class="m-0 list-none p-0"><li><a title="即時中國" target="_self" class="leading-7 text-black-78" href="/channel/364/%E5%8D%B3%E6%99%82%E4%B8%AD%E5%9C%8B">即時中國</a></li><li><a title="大國小事" target="_self" class="leading-7 text-black-78" href="/channel/366/%E5%A4%A7%E5%9C%8B%E5%B0%8F%E4%BA%8B">大國小事</a></li><li><a title="北上廣東" target="_self" class="leading-7 text-black-78" href="/channel/477/%E5%8C%97%E4%B8%8A%E5%BB%A3%E6%9D%B1">北上廣東</a></li><li><a title="藝文中國" target="_self" class="leading-7 text-black-78" href="/channel/369/%E8%97%9D%E6%96%87%E4%B8%AD%E5%9C%8B">藝文中國</a></li><li><a title="中國觀察" target="_self" class="leading-7 text-black-78" href="/channel/458/%E4%B8%AD%E5%9C%8B%E8%A7%80%E5%AF%9F">中國觀察</a></li><li><a title="台灣新聞" target="_self" class="leading-7 text-black-78" href="/channel/367/%E5%8F%B0%E7%81%A3%E6%96%B0%E8%81%9E">台灣新聞</a></li></ul></div><div><a title="生活" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/8/%E7%94%9F%E6%B4%BB">生活</a><ul class="m-0 list-none p-0"><li><a title="教煮" target="_self" class="leading-7 text-black-78" href="/channel/38/%E6%95%99%E7%85%AE">教煮</a></li><li><a title="親子" target="_self" class="leading-7 text-black-78" href="/channel/26/%E8%A6%AA%E5%AD%90">親子</a></li><li><a title="寵物" target="_self" class="leading-7 text-black-78" href="/channel/28/%E5%AF%B5%E7%89%A9">寵物</a></li><li><a title="教育職場" target="_self" class="leading-7 text-black-78" href="/channel/142/%E8%81%B7%E5%A0%B4">教育職場</a></li><li><a title="好生活" target="_self" class="leading-7 text-black-78" href="/channel/25/%E5%A5%BD%E7%94%9F%E6%B4%BB">好生活</a></li><li><a title="網購攻略" target="_self" class="leading-7 text-black-78" href="/channel/442/%E7%B6%B2%E8%B3%BC%E6%94%BB%E7%95%A5">網購攻略</a></li></ul></div><div><a title="科技" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/11/%E7%A7%91%E6%8A%80%E7%8E%A9%E7%89%A9">科技</a><ul class="m-0 list-none p-0"><li><a title="實用教學" target="_self" class="leading-7 text-black-78" href="/channel/445/%E5%AF%A6%E7%94%A8%E6%95%99%E5%AD%B8">實用教學</a></li><li><a title="數碼生活" target="_self" class="leading-7 text-black-78" href="/channel/391/%E6%95%B8%E7%A2%BC%E7%94%9F%E6%B4%BB">數碼生活</a></li><li><a title="遊戲動漫" target="_self" class="leading-7 text-black-78" href="/channel/390/%E9%81%8A%E6%88%B2%E5%8B%95%E6%BC%AB">遊戲動漫</a></li><li><a title="網科3.0" target="_self" class="leading-7 text-black-78" href="/channel/479/%E7%B6%B2%E7%A7%913-0">網科3.0</a></li><li><a title="攝影專區" target="_self" class="leading-7 text-black-78" href="/zone/13/%E5%BD%B1%E5%83%8F?itm_source=webmenu&amp;itm_medium=web">攝影專區</a></li></ul></div><div><a title="體育" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/3/%E9%AB%94%E8%82%B2">體育</a><ul class="m-0 list-none p-0"><li><a title="即時體育" target="_self" class="leading-7 text-black-78" href="/channel/20/%E5%8D%B3%E6%99%82%E9%AB%94%E8%82%B2">即時體育</a></li><li><a title="跑步行山" target="_self" class="leading-7 text-black-78" href="/channel/30/%E8%B7%91%E6%AD%A5">跑步行山</a></li><li><a title="Jumper" target="_self" class="leading-7 text-black-78" href="/channel/184/Jumper">Jumper</a></li><li><a title="武備志" target="_self" class="leading-7 text-black-78" href="/channel/166/%E6%AD%A6%E5%82%99%E5%BF%97">武備志</a></li><li><a title="動感影像" target="_self" class="leading-7 text-black-78" href="/channel/256/%E5%8B%95%E6%84%9F?itm_source=webmenu&amp;itm_medium=web">動感影像</a></li></ul></div><div><a title="01深圳" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/25/01%E6%B7%B1%E5%9C%B3">01深圳</a><ul class="m-0 list-none p-0"><li><a title="深圳好去處" target="_self" class="leading-7 text-black-78" href="/channel/483/%E6%B7%B1%E5%9C%B3%E5%A5%BD%E5%8E%BB%E8%99%95">深圳好去處</a></li><li><a title="深圳新聞" target="_self" class="leading-7 text-black-78" href="/channel/482/%E6%B7%B1%E5%9C%B3%E6%96%B0%E8%81%9E">深圳新聞</a></li><li><a title="深港發展" target="_self" class="leading-7 text-black-78" href="/channel/485/%E6%B7%B1%E6%B8%AF%E7%99%BC%E5%B1%95">深港發展</a></li><li><a title="人物專題" target="_self" class="leading-7 text-black-78" href="/channel/484/%E4%BA%BA%E7%89%A9%E5%B0%88%E9%A1%8C">人物專題</a></li></ul></div><div><a title="經濟" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/14/%E7%B6%93%E6%BF%9F">經濟</a><ul class="m-0 list-none p-0"><li><a title="財經快訊" target="_self" class="leading-7 text-black-78" href="/channel/396/%E8%B2%A1%E7%B6%93%E5%BF%AB%E8%A8%8A">財經快訊</a></li><li><a title="投資理財" target="_self" class="leading-7 text-black-78" href="/channel/487/%E6%8A%95%E8%B3%87%E7%90%86%E8%B2%A1">投資理財</a></li><li><a title="地產樓市" target="_self" class="leading-7 text-black-78" href="/channel/399/%E5%9C%B0%E7%94%A2%E6%A8%93%E5%B8%82">地產樓市</a></li><li><a title="專題人訪" target="_self" class="leading-7 text-black-78" href="/channel/400/%E5%B0%88%E9%A1%8C%E4%BA%BA%E8%A8%AA">專題人訪</a></li></ul></div><div><a title="觀點" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/12/%E8%A7%80%E9%BB%9E">觀點</a><ul class="m-0 list-none p-0"><li><a title="社論" target="_self" class="leading-7 text-black-78" href="/channel/449/%E7%A4%BE%E8%AB%96">社論</a></li><li><a title="全部" target="_self" class="leading-7 text-black-78" href="/zone/12/%E5%85%A8%E9%83%A8">全部</a></li><li><a title="01觀點" target="_self" class="leading-7 text-black-78" href="/channel/50/01%E8%A7%80%E9%BB%9E">01觀點</a></li><li><a title="01論壇" target="_self" class="leading-7 text-black-78" href="/channel/415/01%E8%AB%96%E5%A3%87">01論壇</a></li><li><a title="01專欄" target="_self" class="leading-7 text-black-78" href="/channel/480/01%E5%B0%88%E6%AC%84">01專欄</a></li></ul></div><div><a title="健康" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/24/%E5%81%A5%E5%BA%B7">健康</a><ul class="m-0 list-none p-0"><li><a title="健康Easy" target="_self" class="leading-7 text-black-78" href="/channel/444/%E5%81%A5%E5%BA%B7Easy">健康Easy</a></li><li><a title="醫師Easy" target="_self" class="leading-7 text-black-78" href="/channel/463/%E9%86%AB%E5%B8%ABEasy">醫師Easy</a></li><li><a title="醫美Easy" target="_self" class="leading-7 text-black-78" href="/channel/464/%E9%86%AB%E7%BE%8EEasy">醫美Easy</a></li></ul></div><div><a title="好食玩飛" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/19/%E5%A5%BD%E9%A3%9F%E7%8E%A9%E9%A3%9B">好食玩飛</a><ul class="m-0 list-none p-0"><li><a title="食玩買" target="_self" class="leading-7 text-black-78" href="/channel/446/%E9%A3%9F%E7%8E%A9%E8%B2%B7">食玩買</a></li><li><a title="旅遊" target="_self" class="leading-7 text-black-78" href="/channel/411/%E6%97%85%E9%81%8A">旅遊</a></li><li><a title="活動好去處" target="_self" class="leading-7 text-black-78" href="/channel/178/01%E6%B4%BB%E5%8B%95?utm_source=webmenu&amp;utm_medium=web">活動好去處</a></li></ul></div><div><a title="女生" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/6/%E5%A5%B3%E7%94%9F">女生</a><ul class="m-0 list-none p-0"><li><a title="穿搭筆記" target="_self" class="leading-7 text-black-78" href="/channel/387/%E7%A9%BF%E6%90%AD%E7%AD%86%E8%A8%98">穿搭筆記</a></li><li><a title="美容手帳" target="_self" class="leading-7 text-black-78" href="/channel/443/%E7%BE%8E%E5%AE%B9%E6%89%8B%E5%B8%B3">美容手帳</a></li><li><a title="知性女生" target="_self" class="leading-7 text-black-78" href="/channel/388/%E7%9F%A5%E6%80%A7%E5%A5%B3%E7%94%9F">知性女生</a></li><li><a title="談情說性" target="_self" class="leading-7 text-black-78" href="/channel/389/%E8%AB%87%E6%83%85%E8%AA%AA%E6%80%A7">談情說性</a></li></ul></div><div><a title="熱話" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/7/%E7%86%B1%E8%A9%B1">熱話</a><ul class="m-0 list-none p-0"><li><a title="熱爆話題" target="_self" class="leading-7 text-black-78" href="/channel/7/%E7%86%B1%E7%88%86%E8%A9%B1%E9%A1%8C">熱爆話題</a></li><li><a title="開罐" target="_self" class="leading-7 text-black-78" href="/channel/317/%E9%96%8B%E7%BD%90">開罐</a></li><li><a title="人氣話題" target="_self" class="leading-7 text-black-78" href="/channel/489/%E4%BA%BA%E6%B0%A3%E8%A9%B1%E9%A1%8C">人氣話題</a></li><li><a title="影像熱話" target="_self" class="leading-7 text-black-78" href="/channel/260/%E5%BD%B1%E5%83%8F%E7%86%B1%E8%A9%B1?utm_source=webmenu&amp;itm_medium=web">影像熱話</a></li></ul></div><div><a title="藝文格物" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/9/%E8%97%9D%E6%96%87%E6%A0%BC%E7%89%A9">藝文格物</a><ul class="m-0 list-none p-0"><li><a title="一物" target="_self" class="leading-7 text-black-78" href="/channel/182/%E4%B8%80%E7%89%A9">一物</a></li><li><a title="藝文" target="_self" class="leading-7 text-black-78" href="/channel/206/%E8%97%9D%E6%96%87">藝文</a></li><li><a title="攝影界" target="_self" class="leading-7 text-black-78" href="/channel/348/%E6%94%9D%E5%BD%B1%E7%95%8C?utm_source=webmenu&amp;itm_medium=web">攝影界</a></li></ul></div><div><a title="社區" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/10/%E7%A4%BE%E5%8D%80">社區</a><ul class="m-0 list-none p-0"><li><a title="社區專題" target="_self" class="leading-7 text-black-78" href="/channel/23/%E7%A4%BE%E5%8D%80%E5%B0%88%E9%A1%8C">社區專題</a></li><li><a title="18區新聞" target="_self" class="leading-7 text-black-78" href="/channel/422/18%E5%8D%80%E6%96%B0%E8%81%9E">18區新聞</a></li><li><a title="隱形香港" target="_self" class="leading-7 text-black-78" href="/channel/293/%E9%9A%B1%E5%BD%A2%E9%A6%99%E6%B8%AF">隱形香港</a></li><li><a title="紀實影像" target="_self" class="leading-7 text-black-78" href="/channel/259/%E7%B4%80%E5%AF%A6?itm_source=webmenu&amp;itm_medium=web">紀實影像</a></li></ul></div><div><a title="教育" target="_self" class="text-xl font-semibold leading-loose !text-blue-500" href="/zone/23/%E6%95%99%E8%82%B2">教育</a><ul class="m-0 list-none p-0"><li><a title="中小學校園" target="_self" class="leading-7 text-black-78" href="/channel/468/%E4%B8%AD%E5%B0%8F%E5%AD%B8%E6%A0%A1%E5%9C%92">中小學校園</a></li><li><a title="教育發展" target="_self" class="leading-7 text-black-78" href="/channel/474/%E6%95%99%E8%82%B2%E7%99%BC%E5%B1%95">教育發展</a></li><li><a title="DSE專區" target="_self" class="leading-7 text-black-78" href="/channel/473/DSE%E5%B0%88%E5%8D%80">DSE專區</a></li><li><a title="專上教育" target="_self" class="leading-7 text-black-78" href="/channel/469/%E5%B0%88%E4%B8%8A%E6%95%99%E8%82%B2">專上教育</a></li><li><a title="海外升學" target="_self" class="leading-7 text-black-78" href="/channel/475/%E6%B5%B7%E5%A4%96%E5%8D%87%E5%AD%B8">海外升學</a></li><li><a title="深造進修" target="_self" class="leading-7 text-black-78" href="/channel/476/%E6%B7%B1%E9%80%A0%E9%80%B2%E4%BF%AE">深造進修</a></li></ul></div></div></div>"""

# Extract all links with titles and hrefs
pattern = r'<a\s+[^>]*title="([^"]+)"[^>]*href="([^"]+)"[^>]*>'
matches = re.findall(pattern, html_content)

# Filter for /zone/ and /channel/ URLs
categories = []
for title, href in matches:
    # Remove query parameters from href
    clean_href = href.split('?')[0]
    
    if clean_href.startswith('/zone/') or clean_href.startswith('/channel/'):
        id_match = re.match(r'/(zone|channel)/(\d+)/', clean_href)
        if id_match:
            cat_type = id_match.group(1)
            cat_id = id_match.group(2)
            categories.append({
                'title': title,
                'href': clean_href,
                'type': cat_type,
                'id': cat_id,
                'slug': f"{cat_id}-{title}"
            })

# Remove duplicates
unique_categories = []
seen = set()
for cat in categories:
    key = (cat['id'], cat['title'])
    if key not in seen:
        unique_categories.append(cat)
        seen.add(key)

# Write to file with UTF-8 encoding
output_file = 'hk01_categories_insert.sql'
with open(output_file, 'w', encoding='utf-8') as f:
    f.write("-- " + "="*76 + "\n")
    f.write("-- HK01 Scraper Categories - INSERT Statements WITH METADATA\n")
    f.write("-- Generated: 2025-12-06\n")
    f.write(f"-- Total Categories: {len(unique_categories)} (Zones + Channels)\n")
    f.write("-- " + "="*76 + "\n")
    f.write("-- Instructions:\n")
    f.write("-- 1. Ensure 'hk01' source exists in news_sources table\n")
    f.write("-- 2. Run this script in Supabase SQL Editor\n")
    f.write("-- 3. Metadata includes zoneId and zoneUrl for each category\n")
    f.write("-- " + "="*76 + "\n\n")
    
    for i, cat in enumerate(unique_categories, 1):
        title_escaped = cat['title'].replace("'", "''")
        slug_escaped = cat['slug'].replace("'", "''")
        zone_url = f"https://www.hk01.com{cat['href']}"
        
        # Create metadata JSON
        metadata_obj = {
            "zoneId": cat['id'],
            "zoneUrl": zone_url
        }
        metadata_json = json.dumps(metadata_obj, ensure_ascii=False)
        
        sql = f"INSERT INTO scraper_categories (source_id, slug, name, priority, is_enabled, metadata)\n"
        sql += f"VALUES ((SELECT id FROM news_sources WHERE source_key = 'hk01'), "
        sql += f"'{slug_escaped}', '{title_escaped}', {100 - (i % 50)}, true, '{metadata_json}');\n\n"
        
        f.write(sql)
    
    f.write("-- " + "="*76 + "\n")
    f.write("-- END OF INSERT STATEMENTS\n")
    f.write("-- " + "="*76 + "\n")
    f.write(f"-- Total: {len(unique_categories)} categories inserted with metadata\n")
    f.write("-- " + "="*76 + "\n")

print(f"✅ Generated {output_file} with {len(unique_categories)} categories")
print(f"✅ All categories include metadata with zoneId and zoneUrl")
